!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.PixFace=t()}("undefined"!=typeof self?self:this,function(){"use strict";var e={apiURL:"https://api.dev.pixtopay.com",kycFrontOrigin:"https://kyc.dev.pixtopay.com",lang:"pt",onSuccess:null,onError:null,eventHandler:null,enableRedirect:!1,autoOpenValidation:!1,allowedPostMessageOrigins:null,integrationId:null,api_key:null,publicKey:null},t={cpf:"pixface-hydrate-cpf",referenceId:"pixface-hydrate-referenceId",action:"pixface-hydrate-action",email:"pixface-hydrate-email",phone:"pixface-hydrate-phone"},n={verify:"pixface-action-verify","verify-sow-flow":"pixface-action-verify-sow-flow",faceindex:"pixface-action-faceindex",close_dialog:"pixface-action-close_dialog"};function r(e){return(e||"").replace(/\D+/g,"").slice(0,11)}function i(e){var t=(e||"").replace(/\D+/g,"");if(11!==t.length)return!1;if(/^(\d)\1{10}$/.test(t))return!1;var n,r,i=0;for(r=1;r<=9;r++)i+=parseInt(t.substring(r-1,r),10)*(11-r);if(10!==(n=10*i%11)&&11!==n||(n=0),n!==parseInt(t.substring(9,10),10))return!1;for(i=0,r=1;r<=10;r++)i+=parseInt(t.substring(r-1,r),10)*(12-r);return 10!==(n=10*i%11)&&11!==n||(n=0),n===parseInt(t.substring(10,11),10)}function o(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return function(a){var c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}(e,a||{});if(!c.integrationId)throw new Error("[PixFace] integrationId is required");var d=c.api_key||c.publicKey;if(!d)throw new Error("[PixFace] api_key is required");c.allowedPostMessageOrigins&&Array.isArray(c.allowedPostMessageOrigins)||(c.allowedPostMessageOrigins=[c.kycFrontOrigin]);var l={mounted:!1,styleEl:null,rootEl:null,dialogEl:null,contentEl:null,iframeEl:null,fieldIds:o(t),actionIds:o(n),currentGuid:null,currentFeature:null,messageListener:null,lang:c.lang||"pt"};function f(){var e=Array.prototype.slice.call(arguments);try{console.warn.apply(console,["[PixFace]"].concat(e))}catch(e){}}function s(e,t){if("function"==typeof c.onError)try{c.onError(e,t)}catch(e){}}function u(e){if("function"==typeof c.eventHandler)try{c.eventHandler(e)}catch(e){}}function p(e,t){l.dialogEl&&(e?(l.dialogEl.setAttribute("data-open","true"),document.body.style.overflow="hidden",u({name:"modal",status:"open",refId:t})):(l.dialogEl.setAttribute("data-open","false"),l.dialogEl.style.display="",document.body.style.overflow="",u({name:"modal",status:"close",refId:t})))}function g(e){if(!e)return"";var t=document.getElementById(e);return t?(t.value||"").toString():""}function m(e,t){var n=document.getElementById(e);if(n)if(t){n.setAttribute("data-pixface-invalid","true");try{n.focus()}catch(e){}}else n.removeAttribute("data-pixface-invalid")}function y(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=l.actionIds[r];if(i){var o=document.getElementById(i);o&&(t?(o.setAttribute("data-pixface-loading","true"),o.disabled=!0):(o.removeAttribute("data-pixface-loading"),o.disabled=!1))}}}function v(e){var t=r(e.cpf),n=c.apiURL.replace(/\/$/,"")+"/customer/register",i={cpf:t,integration_id:String(c.integrationId)},o={"Content-Type":"application/json"};return d&&(o.Authorization="Bearer "+String(d)),fetch(n,{method:"POST",headers:o,body:JSON.stringify(i)}).then(function(e){return e.ok?e.json():e.text().then(function(t){var n={status:e.status,body:t};throw s("bad_request",n),n})}).then(function(e){if(!e||!e.onboarding_id){var t={reason:"invalid_response",json:e};throw s("invalid_response",t),t}return String(e.onboarding_id)}).catch(function(e){var n;throw f("session error for CPF",!(n=t)||n.length<3?"***":"***"+n.slice(-3),e),e&&e.reason||s("network",e),e})}function h(e,t,n,r,i,o){return c.kycFrontOrigin.replace(/\/$/,"")+"/"+function(e){var t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];null!=r&&""!==r&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(String(r)))}return t.length?"?"+t.join("&"):""}({guid:e,step:1,lang:n,refId:r,action:i,onlyliveness:o?1:void 0})}function I(e){var t=h(e.guid,e.feature,l.lang,e.referenceId,e.action,e.onlyliveness);l.iframeEl&&(l.iframeEl.src=t,l.currentGuid=e.guid,l.currentFeature=e.feature,p(!0,e.referenceId))}function x(){if(!l.messageListener){var e=function(e){try{if(!e||!e.origin)return;if(-1===c.allowedPostMessageOrigins.indexOf(e.origin))return;var t=e.data;if(!t||"object"!=typeof t)return;if("COPY_TO_CLIPBOARD"===t.type&&"string"==typeof t.text){var n=t.text;return void(navigator&&navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n):Promise.reject(new Error("Clipboard API not available"))).then(function(){try{e.source&&e.source.postMessage({type:"COPY_SUCCESS"},e.origin)}catch(e){}}).catch(function(){try{e.source&&e.source.postMessage({type:"COPY_FAILED"},e.origin)}catch(e){}})}var r=t.type||t.name;if(!r)return;if("close-modal"===r||"close_modal"===r||"close"===r)return void E({refId:t.refId});if("redirect"===r&&c.enableRedirect&&t&&t.url){try{window.location.href=String(t.url)}catch(e){}return}if("success"===r)return function(e,t){if("function"==typeof c.onSuccess)try{c.onSuccess(e,t)}catch(e){}}(t.eventName||"success",t.payload),void u(t);if("error"===r)return s(t.eventName||"error",t.payload),void u(t);u(t)}catch(e){f("message handling error",e)}};window.addEventListener("message",e),l.messageListener=e}}function b(e,t,n,o){var a=o&&(o.cpf||o.referenceId||o.action)?{cpf:r(o.cpf||""),referenceId:o.referenceId,action:o.action}:{cpf:r(g(l.fieldIds.cpf)),referenceId:g(l.fieldIds.referenceId)||void 0,action:g(l.fieldIds.action)||void 0};return i(a.cpf)?(m(l.fieldIds.cpf,!1),y([e],!0),v({cpf:a.cpf}).then(function(e){I({guid:e,feature:n,referenceId:a.referenceId,action:a.action,onlyliveness:"faceindex"===n})}).catch(function(e){return null}).finally(function(){y([e],!1)})):(s("invalid_cpf",{field:"cpf"}),m(l.fieldIds.cpf,!0),Promise.resolve())}function w(){var e=document.getElementById(l.actionIds.verify);e&&(e.onclick=function(){b("verify",0,"verify")});var t=document.getElementById(l.actionIds["verify-sow-flow"]);t&&(t.onclick=function(){b("verify-sow-flow",0,"sow")});var n=document.getElementById(l.actionIds.faceindex);n&&(n.onclick=function(){b("faceindex",0,"faceindex")});var r=document.getElementById(l.actionIds.close_dialog);r&&(r.onclick=function(){E({refId:g(l.fieldIds.referenceId)||void 0})})}function E(e){p(!1,e&&e.refId),l.iframeEl&&l.iframeEl.removeAttribute("src")}return{mount:function(){return new Promise(function(e){l.mounted||(function(){if(!l.styleEl){var e=document.createElement("style");e.setAttribute("data-pixface","true"),e.type="text/css",e.appendChild(document.createTextNode(':root{--pf-primary:#a9d001;--pf-dark:#1d2939;--pf-bg:#f9fafb;--pf-success:#22c55e;--pf-warning:#f59e0b;--pf-error:#ef4444;--pf-card:#ffffff;--pf-muted:#f2f4f7;}.pf-dialog{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:999999;}.pf-dialog[data-open="true"]{display:flex;}.pf-dialog__content{position:relative;width:100%;max-width:425px;height:90dvh;max-height:900px;border-radius:12px;background:var(--pf-card,#ffffff);box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden;}@media (max-width: 480px){.pf-dialog__content{width:95dvw;max-width:95dvw;height:90dvh;}}.pf-dialog__close{position:absolute;top:8px;right:8px;background:var(--pf-muted,#f2f4f7);border:none;border-radius:8px;padding:8px 10px;cursor:pointer;color:var(--pf-dark,#1d2939);font-weight:600;}.pf-hidden{display:none !important;}')),document.head.appendChild(e),l.styleEl=e}}(),function(){if(!(l.rootEl&&l.dialogEl&&l.contentEl)){var e=document.getElementById("pixface-root");e||((e=document.createElement("div")).id="pixface-root",document.body.appendChild(e));var t=document.createElement("div");t.className="pf-dialog",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");var n=document.createElement("div");n.className="pf-dialog__content";var r=document.createElement("iframe");r.id="pixface-iframe",r.setAttribute("allow","camera; geolocation; microphone; clipboard-write; fullscreen"),r.setAttribute("referrerpolicy","origin"),r.setAttribute("style","width:100%; height:100%; border:0;");var i=document.createElement("button");i.id=l.actionIds.close_dialog,i.className="pf-dialog__close"+(c.autoOpenValidation?" pf-hidden":""),i.type="button",i.textContent="Ã—",n.appendChild(i),n.appendChild(r),t.appendChild(n),e.appendChild(t),l.rootEl=e,l.dialogEl=t,l.contentEl=n,l.iframeEl=r}}(),x(),w(),l.mounted=!0,c.autoOpenValidation),e()})},setLang:function(e){if(l.lang=e||"pt",l.iframeEl&&l.iframeEl.src)try{var t=new URL(l.iframeEl.src,window.location.href);t.searchParams.set("lang",l.lang),l.iframeEl.src=t.toString()}catch(e){if(l.currentGuid){var n=h(l.currentGuid,l.currentFeature,l.lang);l.iframeEl.src=n}}},closeModal:E,changeFieldId:function(e){e&&e.fieldName&&e.fieldId&&Object.prototype.hasOwnProperty.call(l.fieldIds,e.fieldName)&&(l.fieldIds[e.fieldName]=String(e.fieldId))},changeActionId:function(e){e&&e.actionName&&e.actionId&&Object.prototype.hasOwnProperty.call(l.actionIds,e.actionName)&&(l.actionIds[e.actionName]=String(e.actionId),w())},verifyDocument:function(e){return b("verify",0,"verify",e)},openVerifySOWFlow:function(e){return b("verify-sow-flow",0,"sow",e)},startFaceIndex:function(e){return b("faceindex",0,"faceindex",e)},checkCPF:function(e){return i(r(e))},normalizeCPF:r,isValidCPF:i,createSession:v,openModalWithGuid:I,attachActionHandlers:w,attachMessageListener:x}}});