!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.PixFace=t()}("undefined"!=typeof self?self:this,function(){"use strict";var e={apiURL:"https://api.dev.pixtopay.com",kycFrontOrigin:"https://kyc.dev.pixtopay.com",lang:"pt",onSuccess:null,onError:null,eventHandler:null,enableRedirect:!1,autoOpenValidation:!1,allowedPostMessageOrigins:null,integrationId:null,api_key:null,publicKey:null,lockBodyScroll:!0,injectResponsiveStyles:!1,forceMobileViewport:!1,mobileMaxWidth:null,showCloseButton:null,optimizeResizeUpdates:!0,strictLang:!1,allowedLangs:["pt","en","es"]},t={cpf:"pixface-hydrate-cpf",referenceId:"pixface-hydrate-referenceId",action:"pixface-hydrate-action",email:"pixface-hydrate-email",phone:"pixface-hydrate-phone"},n={verify:"pixface-action-verify","verify-sow-flow":"pixface-action-verify-sow-flow",faceindex:"pixface-action-faceindex",close_dialog:"pixface-action-close_dialog"};function i(e){return(e||"").replace(/\D+/g,"").slice(0,11)}function r(e){var t=(e||"").replace(/\D+/g,"");if(11!==t.length)return!1;if(/^(\d)\1{10}$/.test(t))return!1;var n,i,r=0;for(i=1;i<=9;i++)r+=parseInt(t.substring(i-1,i),10)*(11-i);if(10!==(n=10*r%11)&&11!==n||(n=0),n!==parseInt(t.substring(9,10),10))return!1;for(r=0,i=1;i<=10;i++)r+=parseInt(t.substring(i-1,i),10)*(12-i);return 10!==(n=10*r%11)&&11!==n||(n=0),n===parseInt(t.substring(10,11),10)}function o(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return function(a){var c=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}(e,a||{});if(!c.integrationId)throw new Error("[PixFace] integrationId is required");var l=c.api_key||c.publicKey;if(!l)throw new Error("[PixFace] api_key is required");c.allowedPostMessageOrigins&&Array.isArray(c.allowedPostMessageOrigins)||(c.allowedPostMessageOrigins=[c.kycFrontOrigin]);var d={mounted:!1,styleEl:null,rootEl:null,dialogEl:null,contentEl:null,iframeEl:null,fieldIds:o(t),actionIds:o(n),currentGuid:null,currentFeature:null,messageListener:null,lang:c.lang||"pt"};function f(){var e=Array.prototype.slice.call(arguments);try{console.warn.apply(console,["[PixFace]"].concat(e))}catch(e){}}function s(e,t){if("function"==typeof c.onError)try{c.onError(e,t)}catch(e){}}function u(e){if("function"==typeof c.eventHandler)try{c.eventHandler(e)}catch(e){}}function p(){if(!(d.rootEl&&d.dialogEl&&d.contentEl)){var e=document.getElementById("pixface-root");e||((e=document.createElement("div")).id="pixface-root",document.body.appendChild(e));var t=document.createElement("div");t.className="pf-dialog",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");var n=document.createElement("div");if(n.className="pf-dialog__content",c.forceMobileViewport&&"number"==typeof c.mobileMaxWidth)try{n.style.maxWidth=String(c.mobileMaxWidth)+"px",n.style.width="100%",n.style.margin="0 auto"}catch(e){}var i=document.createElement("iframe");i.id="pixface-iframe",i.setAttribute("allow","camera; geolocation; microphone; clipboard-write; fullscreen"),i.setAttribute("referrerpolicy","origin"),i.setAttribute("style","width:100%; height:100%; border:0;");var r=document.createElement("button");r.id=d.actionIds.close_dialog,r.className="pf-dialog__close"+(function(){if("boolean"==typeof c.showCloseButton)return!c.showCloseButton;return!!c.autoOpenValidation}()?" pf-hidden":""),r.type="button",r.textContent="Ã—",n.appendChild(r),n.appendChild(i),t.appendChild(n),e.appendChild(t),d.rootEl=e,d.dialogEl=t,d.contentEl=n,d.iframeEl=i}}var g=null;function y(){try{var e=window.screen.availHeight-window.innerHeight,t=window.screen.availHeight-(e>0?e:0);document.documentElement.style.setProperty("--pf-popup-height",String(t)+"px")}catch(e){}}function m(e,t){if(d.dialogEl)if(e){d.dialogEl.setAttribute("data-open","true"),c.lockBodyScroll&&(document.body.style.overflow="hidden");try{d.dialogEl.focus&&d.dialogEl.focus()}catch(e){}u({name:"modal",status:"open",refId:t})}else d.dialogEl.setAttribute("data-open","false"),d.dialogEl.style.display="",c.lockBodyScroll&&(document.body.style.overflow=""),u({name:"modal",status:"close",refId:t})}function v(e){if(!e)return"";var t=document.getElementById(e);return t?(t.value||"").toString():""}function h(e,t){var n=document.getElementById(e);if(n)if(t){n.setAttribute("data-pixface-invalid","true");try{n.focus()}catch(e){}}else n.removeAttribute("data-pixface-invalid")}function w(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=d.actionIds[i];if(r){var o=document.getElementById(r);o&&(t?(o.setAttribute("data-pixface-loading","true"),o.disabled=!0):(o.removeAttribute("data-pixface-loading"),o.disabled=!1))}}}function x(e){var t=i(e.cpf),n=c.apiURL.replace(/\/$/,"")+"/customer/register",r={cpf:t,integration_id:String(c.integrationId)},o={"Content-Type":"application/json"};return l&&(o.Authorization="Bearer "+String(l)),fetch(n,{method:"POST",headers:o,body:JSON.stringify(r)}).then(function(e){return e.ok?e.json():e.text().then(function(t){var n={status:e.status,body:t};throw s("bad_request",n),n})}).then(function(e){if(!e||!e.onboarding_id){var t={reason:"invalid_response",json:e};throw s("invalid_response",t),t}return String(e.onboarding_id)}).catch(function(e){var n;throw f("session error for CPF",!(n=t)||n.length<3?"***":"***"+n.slice(-3),e),e&&e.reason||s("network",e),e})}function b(e,t,n,i,r,o){return c.kycFrontOrigin.replace(/\/$/,"")+"/"+function(e){var t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=e[n];null!=i&&""!==i&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(String(i)))}return t.length?"?"+t.join("&"):""}({guid:e,step:1,lang:n,refId:i,action:r,onlyliveness:o?1:void 0})}function I(e){var t=b(e.guid,e.feature,d.lang,e.referenceId,e.action,e.onlyliveness);d.iframeEl&&(d.iframeEl.src=t,d.currentGuid=e.guid,d.currentFeature=e.feature,m(!0,e.referenceId))}function E(){if(!d.messageListener){var e=function(e){try{if(!e||!e.origin)return;if(-1===c.allowedPostMessageOrigins.indexOf(e.origin))return;var t=e.data;if(!t||"object"!=typeof t)return;if("COPY_TO_CLIPBOARD"===t.type&&"string"==typeof t.text){var n=t.text;return void(navigator&&navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n):Promise.reject(new Error("Clipboard API not available"))).then(function(){try{e.source&&e.source.postMessage({type:"COPY_SUCCESS"},e.origin)}catch(e){}}).catch(function(){try{e.source&&e.source.postMessage({type:"COPY_FAILED"},e.origin)}catch(e){}})}var i=t.type||t.name;if(!i)return;if("close-modal"===i||"close_modal"===i||"close"===i)return void _({refId:t.refId});if("redirect"===i&&c.enableRedirect&&t&&t.url){try{window.location.href=String(t.url)}catch(e){}return}if("success"===i)return function(e,t){if("function"==typeof c.onSuccess)try{c.onSuccess(e,t)}catch(e){}}(t.eventName||"success",t.payload),void u(t);if("error"===i)return s(t.eventName||"error",t.payload),void u(t);u(t)}catch(e){f("message handling error",e)}};window.addEventListener("message",e),d.messageListener=e}}function O(e,t,n,o){var a=o&&(o.cpf||o.referenceId||o.action)?{cpf:i(o.cpf||""),referenceId:o.referenceId,action:o.action}:{cpf:i(v(d.fieldIds.cpf)),referenceId:v(d.fieldIds.referenceId)||void 0,action:v(d.fieldIds.action)||void 0};return r(a.cpf)?(h(d.fieldIds.cpf,!1),w([e],!0),x({cpf:a.cpf}).then(function(e){I({guid:e,feature:n,referenceId:a.referenceId,action:a.action,onlyliveness:"faceindex"===n})}).catch(function(e){return null}).finally(function(){w([e],!1)})):(s("invalid_cpf",{field:"cpf"}),h(d.fieldIds.cpf,!0),Promise.resolve())}function P(){var e=document.getElementById(d.actionIds.verify);e&&(e.onclick=function(){O("verify",0,"verify")});var t=document.getElementById(d.actionIds["verify-sow-flow"]);t&&(t.onclick=function(){O("verify-sow-flow",0,"sow")});var n=document.getElementById(d.actionIds.faceindex);n&&(n.onclick=function(){O("faceindex",0,"faceindex")});var i=document.getElementById(d.actionIds.close_dialog);i&&(i.onclick=function(){_({refId:v(d.fieldIds.referenceId)||void 0})})}function _(e){m(!1,e&&e.refId),d.iframeEl&&d.iframeEl.removeAttribute("src")}return{mount:function(){return new Promise(function(e){if(d.mounted)e();else{if(function(){if(!d.styleEl){var e=document.createElement("style");e.setAttribute("data-pixface","true"),e.type="text/css",e.appendChild(document.createTextNode(':root{--pf-primary:#a9d001;--pf-dark:#1d2939;--pf-bg:#f9fafb;--pf-success:#22c55e;--pf-warning:#f59e0b;--pf-error:#ef4444;--pf-card:#ffffff;--pf-muted:#f2f4f7;}.pf-dialog{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:999999;}.pf-dialog[data-open="true"]{display:flex;}.pf-dialog__content{position:relative;width:100%;max-width:425px;height:90dvh;max-height:900px;border-radius:12px;background:var(--pf-card,#ffffff);box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden;}@media (max-width: 480px){.pf-dialog__content{width:95dvw;max-width:95dvw;height:90dvh;}}.pf-dialog__close{position:absolute;top:8px;right:8px;background:var(--pf-muted,#f2f4f7);border:none;border-radius:8px;padding:8px 10px;cursor:pointer;color:var(--pf-dark,#1d2939);font-weight:600;}.pf-hidden{display:none !important;}')),document.head.appendChild(e),d.styleEl=e}}(),p(),c.injectResponsiveStyles){try{d.contentEl.style.height="var(--pf-popup-height, 90dvh)"}catch(e){}c.injectResponsiveStyles&&(window.addEventListener("resize",function(){c.optimizeResizeUpdates?(g&&clearTimeout(g),g=setTimeout(function(){y()},150)):y()}),y())}E(),P(),d.mounted=!0,c.autoOpenValidation,e()}})},setLang:function(e){var t=e||"pt";if(c.strictLang&&-1===c.allowedLangs.indexOf(t)&&(t=c.allowedLangs[0]||"pt"),d.lang=t,d.iframeEl&&d.iframeEl.src)try{var n=new URL(d.iframeEl.src,window.location.href);n.searchParams.set("lang",d.lang),d.iframeEl.src=n.toString()}catch(e){if(d.currentGuid){var i=b(d.currentGuid,d.currentFeature,d.lang);d.iframeEl.src=i}}},closeModal:_,changeFieldId:function(e){e&&e.fieldName&&e.fieldId&&Object.prototype.hasOwnProperty.call(d.fieldIds,e.fieldName)&&(d.fieldIds[e.fieldName]=String(e.fieldId))},changeActionId:function(e){e&&e.actionName&&e.actionId&&Object.prototype.hasOwnProperty.call(d.actionIds,e.actionName)&&(d.actionIds[e.actionName]=String(e.actionId),P())},verifyDocument:function(e){return O("verify",0,"verify",e)},openVerifySOWFlow:function(e){return O("verify-sow-flow",0,"sow",e)},startFaceIndex:function(e){return O("faceindex",0,"faceindex",e)},checkCPF:function(e){return r(i(e))},normalizeCPF:i,isValidCPF:r,createSession:x,openModalWithGuid:I,attachActionHandlers:P,attachMessageListener:E}}});